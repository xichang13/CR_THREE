
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [结构体](#结构体)
  - [参数为结构体](#参数为结构体)
  - [当返回值为结构体](#当返回值为结构体)
- [IDA 中定义结构体](#ida-中定义结构体)

<!-- /code_chunk_output -->


# 结构体

* 结构体成员偏移必须符合公式： member offset % min(struct align, member type) == 0
* 结构体的大小必须满足： 
  * struct size = min(struct align, max(sizeof(member1 type), sizeof(member2 type), ...))
  * sizeof(struct) % struct size == 0

结构体寻址公式：
  * [reg + imm]
  * [imm + imm]

* 可以根据判断数组的方式判断结构体，但是结构体的成员类型可以不一致。

## 参数为结构体

当参数为结构体时，调用函数之前会提前抬栈，将结构体拷贝到栈顶进行入栈，如果结构体小于8个字节，则会通过 edx 和 eax 寄存器传参。

## 当返回值为结构体

当返回值为结构体时，调用参数之前会提前抬栈，然后将结构体的首地址作为第一个参数入栈，然后返回这个结构体首地址。

# IDA 中定义结构体

* `Ctrl + F9` 可以加载.h头文件定义结构体。
* `t` 可以将变量或者寄存器设置为结构体成员。
* `ALT + Q` 可以在栈中设置结构体变量。
* `Shift + F9` 可以定义结构体。
* `Ins` 插入结构体成员。
* `Del` 删除结构体成员。